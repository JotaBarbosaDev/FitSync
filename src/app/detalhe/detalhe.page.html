<ion-header [translucent]="true" class="header-modern">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button color="light" class="fitsync-btn icon"></ion-back-button>
    </ion-buttons>
    <ion-title class="fitsync-text gradient">{{ exercise?.name || 'Detalhes do Exercício' }}</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" class="fitsync-btn icon" (click)="toggleFavorite()" *ngIf="exercise">
        <ion-icon 
          [name]="isFavorite ? 'heart' : 'heart-outline'" 
          [color]="isFavorite ? 'danger' : 'light'">
        </ion-icon>
      </ion-button>
      <ion-button fill="clear" class="fitsync-btn icon" (click)="shareExercise()" *ngIf="exercise">
        <ion-icon name="share-outline" color="light"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="exercise-detail-content" *ngIf="exercise">
  <!-- Hero Image Section -->
  <div class="exercise-hero">
    <img [src]="exercise.imageUrl || 'assets/placeholder-exercise.jpg'" [alt]="exercise.name" class="hero-image" />
    <div class="hero-overlay">
      <div class="exercise-title">
        <h1 class="fitsync-text hero white">{{ exercise.name }}</h1>
        <p class="fitsync-text large light">{{ getMuscleGroupName(exercise.muscleGroup || 'general') }}</p>
      </div>
      <div class="fitsync-badge difficulty" [class]="'difficulty-' + (exercise.difficulty || 'beginner').toLowerCase()">
        {{ exercise.difficulty }}
      </div>
    </div>
  </div>

  <!-- Quick Stats -->
  <div class="quick-stats">
    <div class="fitsync-card metric">
      <ion-icon name="time-outline" class="stat-icon"></ion-icon>
      <div class="stat-info">
        <span class="fitsync-text large white">{{ exercise.duration || 0 }}</span>
        <span class="fitsync-text small muted">minutos</span>
      </div>
    </div>
    <div class="fitsync-card metric">
      <ion-icon name="flame-outline" class="stat-icon"></ion-icon>
      <div class="stat-info">
        <span class="fitsync-text large white">{{ exercise.calories || 0 }}</span>
        <span class="fitsync-text small muted">kcal</span>
      </div>
    </div>
    <div class="fitsync-card metric" *ngIf="exercise?.equipment">
      <ion-icon name="fitness-outline" class="stat-icon"></ion-icon>
      <div class="stat-info">
        <span class="fitsync-text large white">{{ exercise.equipment }}</span>
        <span class="fitsync-text small muted">equipamento</span>
      </div>
    </div>
  </div>

  <!-- Description -->
  <div class="content-section">
    <h2 class="fitsync-text section-title primary">
      <ion-icon name="information-circle-outline"></ion-icon>
      Descrição
    </h2>
    <p class="fitsync-text medium">{{ exercise.description }}</p>
  </div>

  <!-- Instructions -->
  <div class="content-section">
    <h2 class="fitsync-text section-title primary">
      <ion-icon name="list-outline"></ion-icon>
      Como Executar
    </h2>
    <div class="instructions">
      <div class="fitsync-card instruction-step" *ngFor="let instruction of exercise.instructions; let i = index">
        <div class="step-number">{{ i + 1 }}</div>
        <p class="fitsync-text medium">{{ instruction }}</p>
      </div>
    </div>
  </div>

  <!-- Workout Timer Section -->
  <div class="content-section">
    <h2 class="fitsync-text section-title primary">
      <ion-icon name="timer-outline"></ion-icon>
      Timer do Exercício
    </h2>
    <div class="fitsync-card glass timer-container">
      <div class="timer-display">
        <span class="fitsync-text hero primary">{{ formatTime(currentTime) }}</span>
        <p class="fitsync-text large muted">{{ timerState === 'rest' ? 'Descanso' : 'Exercício' }}</p>
      </div>
      <div class="timer-controls">
        <button 
          (click)="startTimer()" 
          [disabled]="isTimerRunning"
          class="fitsync-btn primary large">
          <ion-icon name="play-outline" slot="start"></ion-icon>
          Iniciar Timer
        </button>
        <div class="timer-actions" *ngIf="isTimerRunning">
          <button (click)="pauseTimer()" class="fitsync-btn outline">
            <ion-icon name="pause-outline" slot="start"></ion-icon>
            Pausar
          </button>
          <button (click)="resetTimer()" class="fitsync-btn ghost">
            <ion-icon name="refresh-outline" slot="start"></ion-icon>
            Reset
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- Workout Tracking -->
  <div class="content-section">
    <h2 class="fitsync-text section-title primary">
      <ion-icon name="barbell-outline"></ion-icon>
      Registrar Treino
    </h2>
    
    <!-- Performance History -->
    <div class="performance-history" *ngIf="exerciseHistory.length > 0">
      <h3 class="fitsync-text large primary">Histórico de Performance</h3>
      <div class="fitsync-card glass">
        <div class="chart-placeholder">
          <ion-icon name="analytics-outline"></ion-icon>
          <p class="fitsync-text medium">Último treino: {{ getLastWorkoutDate() }}</p>
          <p class="fitsync-text medium">Melhor série: {{ getBestSet() }}</p>
        </div>
      </div>
    </div>
    
    <div class="workout-tracking">
      <!-- Target Zone -->
      <div class="target-zone" *ngIf="getRecommendedWeight() > 0">
        <h4 class="fitsync-text large primary">Zona Alvo Recomendada</h4>
        <div class="fitsync-card recommendation-card">
          <div class="rec-item">
            <span class="fitsync-text medium muted">Peso:</span>
            <span class="fitsync-text large primary">{{ getRecommendedWeight() }}kg</span>
          </div>
          <div class="rec-item">
            <span class="fitsync-text medium muted">Repetições:</span>
            <span class="fitsync-text large primary">{{ getRecommendedReps() }}</span>
          </div>
        </div>
      </div>

      <div class="sets-container">
        <div class="fitsync-card set-input" *ngFor="let set of workoutSets; let i = index">
          <div class="set-header">
            <span class="fitsync-text large primary">Série {{ i + 1 }}</span>
            <div class="set-status">
              <ion-checkbox 
                [(ngModel)]="set.completed"
                (ionChange)="onSetCompleted(i)"
                color="success">
              </ion-checkbox>
              <span class="fitsync-text medium">Completa</span>
            </div>
          </div>
          <div class="input-row">
            <div class="fitsync-input small">
              <label class="input-label">Reps</label>
              <ion-input 
                [(ngModel)]="set.reps" 
                placeholder="12" 
                type="number"
                [class.completed]="set.completed">
              </ion-input>
            </div>
            <div class="fitsync-input small">
              <label class="input-label">Peso (kg)</label>
              <ion-input 
                [(ngModel)]="set.weight" 
                placeholder="20" 
                type="number"
                step="0.5"
                [class.completed]="set.completed">
              </ion-input>
            </div>
            <div class="fitsync-input small">
              <label class="input-label">RPE</label>
              <ion-input 
                [(ngModel)]="set.rpe" 
                placeholder="8" 
                type="number"
                min="1"
                max="10"
                [class.completed]="set.completed">
              </ion-input>
            </div>
            <button 
              (click)="removeSet(i)" 
              class="fitsync-btn icon ghost">
                            <ion-icon name="trash-outline"></ion-icon>
            </button>
          </div>
          <!-- Rest Timer for each set -->
          <div class="set-rest-timer" *ngIf="set.completed && !isLastSet(i)">
            <div class="mini-timer">
              <ion-icon name="time-outline"></ion-icon>
              <span class="fitsync-text small">Descanso: {{ formatTime(getRestTimeForSet(i)) }}</span>
              <button 
                class="fitsync-btn outline small"
                (click)="startRestTimer(i)"
                [disabled]="restTimers[i].running">
                {{ restTimers[i].running ? 'Executando' : 'Iniciar' }}
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Workout Summary -->
      <div class="fitsync-card glass workout-summary" *ngIf="hasCompletedSets()">
        <h4 class="fitsync-text large primary">Resumo do Treino</h4>
        <div class="summary-stats">
          <div class="stat-item">
            <span class="fitsync-text large primary">{{ getCompletedSets() }}</span>
            <span class="fitsync-text small muted">Séries</span>
          </div>
          <div class="stat-item">
            <span class="fitsync-text large primary">{{ getTotalReps() }}</span>
            <span class="fitsync-text small muted">Repetições</span>
          </div>
          <div class="stat-item">
            <span class="fitsync-text large primary">{{ getTotalVolume() }}</span>
            <span class="fitsync-text small muted">Volume (kg)</span>
          </div>
          <div class="stat-item">
            <span class="fitsync-text large primary">{{ getAverageRPE() }}</span>
            <span class="fitsync-text small muted">RPE Médio</span>
          </div>
        </div>
      </div>

      <div class="workout-actions">
        <button 
          (click)="addSet()" 
          class="fitsync-btn outline large">
          <ion-icon name="add-outline" slot="start"></ion-icon>
          Adicionar Série
        </button>
        <button 
          (click)="saveWorkout()" 
          class="fitsync-btn primary large"
          [disabled]="!hasCompletedSets()">
          <ion-icon name="checkmark-outline" slot="start"></ion-icon>
          Salvar Treino
        </button>
      </div>
    </div>
  </div>

  <!-- Related Exercises -->
  <div class="content-section" *ngIf="relatedExercises.length > 0">
    <h2 class="fitsync-text section-title primary">
      <ion-icon name="fitness-outline"></ion-icon>
      Exercícios Relacionados
    </h2>
    <div class="related-exercises">
      <div class="fitsync-card exercise related-card" 
           *ngFor="let related of relatedExercises" 
           (click)="openRelatedExercise(related)">
        <img [src]="related.imageUrl" [alt]="related.name" />
        <div class="related-info">
          <h4 class="fitsync-text medium white">{{ related.name }}</h4>
          <p class="fitsync-text small muted">{{ getMuscleGroupName(related.muscleGroup) }}</p>
        </div>
      </div>
    </div>
  </div>
</ion-content>

<ion-content [fullscreen]="true" class="loading-content" *ngIf="!exercise">
  <div class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p class="fitsync-text medium">Carregando exercício...</p>
  </div>
</ion-content>
