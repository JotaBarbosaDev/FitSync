<ion-header [translucent]="true" class="header-modern">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button fill="clear" class="fitsync-btn icon">
        <div class="icon-container icon-container-md icon-container-light">
          <ion-icon name="chevron-back" class="icon icon-md icon-hover"></ion-icon>
        </div>
      </ion-button>
    </ion-buttons>
    <ion-title class="headline-medium text-gradient-primary">Progresso & Analytics</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" class="fitsync-btn icon" (click)="openWorkoutHistory()">
        <div class="icon-container icon-container-sm icon-container-primary">
          <ion-icon name="calendar-outline" class="icon icon-sm"></ion-icon>
        </div>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="progress-content">
  <div class="content-container">
    <!-- Loading State -->
    <div class="loading-container" *ngIf="isLoading">
      <div class="icon-container icon-container-xl icon-container-primary">
        <ion-spinner name="crescent" class="icon icon-xl"></ion-spinner>
      </div>
      <p class="body-medium text-muted">Carregando dados de progresso...</p>
    </div>

  <!-- Main Content -->
  <div class="progress-container" *ngIf="!isLoading">
    
    <!-- Performance Overview -->
    <div class="performance-overview" *ngIf="performanceMetrics">
      <h2 class="headline-small text-gradient-primary">
        <div class="icon-container icon-container-sm icon-container-gradient" style="display: inline-flex; margin-right: 8px;">
          <ion-icon name="analytics-outline" class="icon icon-sm"></ion-icon>
        </div>
        Visão Geral
      </h2>
      
      <div class="metrics-grid">
        <div class="fitsync-card metric primary">
          <div class="metric-icon">
            <div class="icon-container icon-container-md icon-container-primary">
              <ion-icon name="barbell-outline" class="icon icon-md"></ion-icon>
            </div>
          </div>
          <div class="metric-info">
            <span class="title-large text-emphasis">{{ performanceMetrics.totalWorkouts || 0 }}</span>
            <span class="body-small text-muted">Treinos Realizados</span>
          </div>
        </div>
        
        <div class="fitsync-card metric success">
          <div class="metric-icon">
            <div class="icon-container icon-container-md icon-container-success">
              <ion-icon name="trending-up-outline" class="icon icon-md"></ion-icon>
            </div>
          </div>
          <div class="metric-info">
            <span class="title-large text-emphasis">{{ formatVolume(performanceMetrics.totalVolume || 0) }}kg</span>
            <span class="body-small text-muted">Volume Total</span>
          </div>
        </div>
        
        <div class="metric-card warning">
          <div class="metric-icon">
            <div class="icon-container icon-container-md icon-container-warning">
              <ion-icon name="time-outline" class="icon icon-md icon-rotate"></ion-icon>
            </div>
          </div>
          <div class="metric-info">
            <span class="title-large text-emphasis">{{ performanceMetrics.averageWorkoutDuration || 0 }}</span>
            <span class="body-small text-muted">Min. Médio</span>
          </div>
        </div>
        
        <div class="metric-card" [ngClass]="getConsistencyColor()">
          <div class="metric-icon">
            <div class="icon-container icon-container-md" [class.icon-container-success]="getConsistencyColor() === 'success'" [class.icon-container-warning]="getConsistencyColor() === 'warning'" [class.icon-container-danger]="getConsistencyColor() === 'danger'">
              <ion-icon name="checkmark-circle-outline" class="icon icon-md"></ion-icon>
            </div>
          </div>
          <div class="metric-info">
            <span class="title-large text-emphasis">{{ performanceMetrics.consistencyScore || 0 }}%</span>
            <span class="body-small text-muted">Consistência</span>
          </div>
        </div>
      </div>
      
      <!-- Progress Description -->
      <div class="progress-description">
        <div class="description-card">
          <div class="icon-container icon-container-md icon-container-warning">
            <ion-icon name="trophy-outline" class="icon icon-md"></ion-icon>
          </div>
          <div>
            <h4 class="title-medium text-emphasis">{{ getProgressDescription() }}</h4>
            <p class="body-medium text-muted">Progresso semanal: <span class="text-success">+{{ performanceMetrics.weeklyProgress || 0 }}%</span></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Overview Charts Section -->
  <div class="section">
    <div class="section-header">
      <h2 class="headline-small text-gradient-primary">Visão Geral dos Gráficos</h2>
      <ion-button fill="clear" size="small" (click)="openWorkoutHistory()">
        <div class="icon-container icon-container-sm icon-container-primary">
          <ion-icon name="analytics-outline" class="icon icon-sm" slot="start"></ion-icon>
        </div>
        <span class="label-medium">Ver Detalhes</span>
      </ion-button>
    </div>

    <div class="charts-grid">
      <!-- Volume Progress Chart -->
      <div class="chart-container">
        <app-progress-chart
          *ngIf="progressData.length > 0"
          [data]="getVolumeChartData()"
          [config]="volumeChartConfig"
          title="Progresso de Volume Total">
        </app-progress-chart>
      </div>

      <!-- Strength Progress Chart -->
      <div class="chart-container">
        <app-progress-chart
          *ngIf="progressData.length > 0"
          [data]="getStrengthChartData()"
          [config]="strengthChartConfig"
          title="Progresso de Força">
        </app-progress-chart>
      </div>
    </div>
  </div>

  <!-- Achievements Section -->
  <div class="achievements-section" *ngIf="achievements.length > 0">
    <div class="section-header">
      <h2 class="headline-small text-gradient-primary">
        <div class="icon-container icon-container-sm icon-container-warning" style="display: inline-flex; margin-right: 8px;">
          <ion-icon name="trophy-outline" class="icon icon-sm"></ion-icon>
        </div>
        Conquistas Recentes
      </h2>
      <ion-button fill="clear" size="small" (click)="openAchievements()">
        <span class="label-medium text-accent">Ver Todas</span>
      </ion-button>
    </div>
    
    <div class="achievements-carousel">
      <div class="achievement-card" 
           *ngFor="let achievement of achievements.slice(0, 3)" 
           [ngClass]="achievement.category">
        <div class="achievement-icon">
          <div class="icon-container icon-container-lg icon-container-gradient">
            <ion-icon [name]="achievement.icon" class="icon icon-lg"></ion-icon>
          </div>
        </div>
        <div class="achievement-info">
          <h4 class="title-medium text-emphasis">{{ achievement.title }}</h4>
          <p class="body-small text-muted">{{ achievement.description }}</p>
          <span class="label-small text-accent">{{ formatDate(achievement.dateEarned) }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <h2 class="headline-small text-gradient-primary">
      <div class="icon-container icon-container-sm icon-container-secondary" style="display: inline-flex; margin-right: 8px;">
        <ion-icon name="filter-outline" class="icon icon-sm"></ion-icon>
      </div>
      Análise de Exercícios
    </h2>
    
    <div class="filter-controls">
      <!-- Time Range Filter -->
      <div class="filter-group">
        <span class="label-medium text-emphasis">Período:</span>
        <div class="filter-chips">
          <ion-chip 
            *ngFor="let range of ['week', 'month', 'quarter', 'year']"
            [class.active]="selectedTimeRange === range"
            (click)="onTimeRangeChange(range)"
            [color]="selectedTimeRange === range ? 'primary' : 'medium'">
            <ion-label class="label-medium">
              {{ range === 'week' ? 'Semana' : 
                 range === 'month' ? 'Mês' : 
                 range === 'quarter' ? 'Trimestre' : 'Ano' }}
            </ion-label>
          </ion-chip>
        </div>
      </div>
      
      <!-- Muscle Group Filter -->
      <div class="filter-group">
        <span class="label-medium text-emphasis">Grupo Muscular:</span>
        <div class="filter-chips">
          <ion-chip 
            *ngFor="let group of muscleGroups"
            [class.active]="selectedMuscleGroup === group.id"
            (click)="onMuscleGroupChange(group.id)"
            [color]="selectedMuscleGroup === group.id ? 'primary' : 'medium'">
            <div class="icon-container icon-container-xs" [class.icon-container-primary]="selectedMuscleGroup === group.id" [class.icon-container-light]="selectedMuscleGroup !== group.id">
              <ion-icon [name]="group.icon" class="icon icon-xs"></ion-icon>
            </div>
            <ion-label class="label-medium">{{ group.name }}</ion-label>
          </ion-chip>
        </div>
      </div>
    </div>
  </div>

  <!-- Exercise Progress -->
  <div class="exercise-progress-section">
    <div class="progress-grid">
      <div class="progress-card" 
           *ngFor="let exercise of progressData" 
           (click)="openExerciseDetail(exercise.exerciseId)">
        
        <!-- Exercise Header -->
        <div class="exercise-header">
          <div class="exercise-info">
            <h3 class="title-medium text-emphasis">{{ exercise.exerciseName }}</h3>
            <span class="muscle-badge" [ngClass]="exercise.muscleGroup">
              <span class="label-small">{{ getMuscleGroupName(exercise.muscleGroup) }}</span>
            </span>
          </div>
          <div class="trend-indicator">
            <div class="icon-container icon-container-sm" [class.icon-container-success]="getTrendColor(exercise.progressTrend) === 'success'" [class.icon-container-warning]="getTrendColor(exercise.progressTrend) === 'warning'" [class.icon-container-danger]="getTrendColor(exercise.progressTrend) === 'danger'">
              <ion-icon 
                [name]="getTrendIcon(exercise.progressTrend)" 
                class="icon icon-sm">
              </ion-icon>
            </div>
          </div>
        </div>
        
        <!-- Progress Stats -->
        <div class="progress-stats">
          <div class="stat-item">
            <span class="title-small text-emphasis">{{ exercise.bestSet.weight }}kg</span>
            <span class="label-small text-muted">Melhor Peso</span>
          </div>
          <div class="stat-item">
            <span class="title-small text-emphasis">{{ exercise.bestSet.reps }}</span>
            <span class="label-small text-muted">Repetições</span>
          </div>
          <div class="stat-item">
            <span class="title-small text-emphasis">{{ formatVolume(exercise.totalVolume) }}</span>
            <span class="label-small text-muted">Volume Total</span>
          </div>
          <div class="stat-item">
            <span class="title-small text-emphasis">{{ exercise.averageRPE.toFixed(1) }}</span>
            <span class="label-small text-muted">RPE Médio</span>
          </div>        </div>
        
        <!-- Mini Chart -->
        <div class="mini-chart">
          <app-progress-chart
            [data]="exercise.chartData"
            [config]="{ type: 'line', color: getTrendColor(exercise.progressTrend) === 'success' ? '#10dc60' : getTrendColor(exercise.progressTrend) === 'danger' ? '#f04141' : '#ffce00', showPoints: false, showGrid: false, height: 80 }"
            [title]="">
          </app-progress-chart>
          <span class="label-small text-muted">{{ exercise.sessions.length }} sessões</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <ion-button 
      expand="block" 
      fill="outline" 
      (click)="openWorkoutHistory()"
      class="action-btn">
      <div class="icon-container icon-container-sm icon-container-primary">
        <ion-icon name="calendar-outline" class="icon icon-sm" slot="start"></ion-icon>
      </div>
      <span class="label-medium">Ver Histórico Completo</span>
    </ion-button>
    
    <ion-button 
      expand="block" 
      fill="solid" 
      color="primary"
      (click)="router.navigate(['/lista'])"
      class="action-btn">
      <div class="icon-container icon-container-sm icon-container-light">
        <ion-icon name="add-outline" class="icon icon-sm" slot="start"></ion-icon>
      </div>
      <span class="label-medium">Novo Treino</span>
    </ion-button>
  </div>
  </div> <!-- Fecha content-container -->
</ion-content>
