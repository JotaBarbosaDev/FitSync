<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="goBack()" fill="clear">
        <ion-icon name="close-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>{{ dayName ? 'Treino de ' + dayName : 'Treino' }}</ion-title>
    <ion-buttons slot="end" *ngIf="workoutStarted && !workoutCompleted">
      <ion-button (click)="finishWorkout()" fill="clear" color="danger">
        <ion-icon name="flag-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  <!-- Tela Inicial - Antes de Come√ßar -->
  <div class="workout-intro" *ngIf="!workoutStarted && exercises.length > 0">
    <div class="intro-header">
      <ion-icon name="fitness-outline" class="workout-icon"></ion-icon>
      <h1>{{ dayName ? 'Treino de ' + dayName : 'Treino' }}</h1>
      <p class="workout-description">Prepare-se para o seu treino!</p>
    </div>

    <div class="workout-overview">
      <div class="overview-stats">
        <div class="stat-item">
          <ion-icon name="list-outline"></ion-icon>
          <span>{{ exercises.length }} exerc√≠cios</span>
        </div>
        <div class="stat-item">
          <ion-icon name="time-outline"></ion-icon>
          <span>~{{ exercises.length * 3 }} min</span>
        </div>
        <div class="stat-item">
          <ion-icon name="flame-outline"></ion-icon>
          <span>{{ getTotalCalories() }} cal</span>
        </div>
      </div>

      <div class="exercises-preview">
        <h3>Exerc√≠cios</h3>
        <div class="exercises-list">
          <div class="exercise-preview" *ngFor="let exercise of exercises; let i = index">
            <div class="exercise-number">{{ i + 1 }}</div>
            <div class="exercise-info">
              <div class="exercise-name">{{ exercise.name }}</div>
              <div class="exercise-details">
                <ion-chip [color]="getDifficultyColor(exercise.difficulty)" size="small">
                  {{ getDifficultyLabel(exercise.difficulty) }}
                </ion-chip>
                <span *ngIf="exercise.emoji">{{ exercise.emoji }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="start-section">
      <ion-button expand="block" size="large" (click)="startWorkout()" class="start-button">
        <ion-icon name="play" slot="start"></ion-icon>
        Come√ßar Treino
      </ion-button>
    </div>
  </div>

  <!-- Execu√ß√£o do Treino -->
  <div class="workout-execution" *ngIf="workoutStarted && !workoutCompleted && currentExercise">

    <!-- Barra de Progresso -->
    <div class="progress-section">
      <div class="progress-info">
        <span>Progresso do Treino</span>
        <span>{{ progressPercentage }}%</span>
      </div>
      <ion-progress-bar [value]="progressPercentage / 100" color="primary"></ion-progress-bar>
    </div>

    <!-- Timer do Treino -->
    <div class="timer-section">
      <div class="workout-timer">
        <ion-icon name="time-outline"></ion-icon>
        <span>{{ formatDuration(workoutDuration) }}</span>
      </div>
      <div class="exercise-counter">
        Exerc√≠cio {{ currentExerciseNumber }} de {{ totalExercises }}
      </div>
    </div>

    <!-- Exerc√≠cio Atual -->
    <div class="current-exercise">
      <div class="exercise-header">
        <h2>{{ currentExercise.name }}</h2>
        <ion-chip [color]="getDifficultyColor(currentExercise.difficulty)">
          {{ getDifficultyLabel(currentExercise.difficulty) }}
        </ion-chip>
      </div>

      <div class="exercise-emoji" *ngIf="currentExercise.emoji">
        {{ currentExercise.emoji }}
      </div>

      <div class="exercise-description" *ngIf="currentExercise.description">
        <p>{{ currentExercise.description }}</p>
      </div>

      <div class="exercise-details">
        <div class="detail-item" *ngIf="currentExercise.duration">
          <ion-icon name="time-outline"></ion-icon>
          <span>{{ currentExercise.duration }} segundos</span>
        </div>
        <div class="detail-item" *ngIf="currentExercise.calories">
          <ion-icon name="flame-outline"></ion-icon>
          <span>{{ currentExercise.calories }} calorias</span>
        </div>
        <div class="detail-item" *ngIf="currentExercise.muscleGroups?.length">
          <ion-icon name="body-outline"></ion-icon>
          <span>{{ currentExercise.muscleGroups.join(', ') }}</span>
        </div>
      </div>

      <div class="exercise-instructions" *ngIf="currentExercise.instructions">
        <h4>Instru√ß√µes:</h4>
        <p>{{ currentExercise.instructions }}</p>
      </div>
    </div>

    <!-- Controles -->
    <div class="exercise-controls">
      <ion-button fill="outline" size="large" (click)="previousExercise()" [disabled]="currentExerciseIndex === 0">
        <ion-icon name="chevron-back" slot="start"></ion-icon>
        Anterior
      </ion-button>

      <ion-button expand="block" size="large" (click)="finishCurrentExercise()" color="success"
        [disabled]="currentExercise.completed">
        <ion-icon name="checkmark" slot="start"></ion-icon>
        {{ currentExercise.completed ? 'Conclu√≠do' : 'Concluir' }}
      </ion-button>

      <ion-button fill="outline" size="large" (click)="nextExercise()"
        [disabled]="currentExerciseIndex === exercises.length - 1">
        Pr√≥ximo
        <ion-icon name="chevron-forward" slot="end"></ion-icon>
      </ion-button>
    </div>
  </div>

  <!-- Treino Conclu√≠do -->
  <div class="workout-completed" *ngIf="workoutCompleted">
    <div class="completion-content">
      <ion-icon name="trophy-outline" class="trophy-icon"></ion-icon>
      <h1>üéâ Parab√©ns!</h1>
      <p>Voc√™ completou seu treino com sucesso!</p>

      <div class="completion-stats">
        <div class="stat-item">
          <ion-icon name="time-outline"></ion-icon>
          <div class="stat-content">
            <div class="stat-value">{{ formatDuration(workoutDuration) }}</div>
            <div class="stat-label">Dura√ß√£o</div>
          </div>
        </div>
        <div class="stat-item">
          <ion-icon name="fitness-outline"></ion-icon>
          <div class="stat-content">
            <div class="stat-value">{{ completedExercises }}/{{ totalExercises }}</div>
            <div class="stat-label">Exerc√≠cios</div>
          </div>
        </div>
      </div>

      <div class="completion-actions">
        <ion-button expand="block" fill="solid" (click)="router.navigate(['/tabs/workout-progress'])"
          class="action-btn">
          <ion-icon name="stats-chart" slot="start"></ion-icon>
          Ver Progresso
        </ion-button>

        <ion-button expand="block" fill="outline" color="secondary" (click)="repeatWorkout()" class="action-btn">
          <ion-icon name="refresh" slot="start"></ion-icon>
          Repetir Treino
        </ion-button>

        <ion-button expand="block" fill="outline" (click)="router.navigate(['/tabs/home'])" class="action-btn">
          <ion-icon name="home" slot="start"></ion-icon>
          Voltar ao In√≠cio
        </ion-button>
      </div>
    </div>
  </div>

  <!-- Estado de erro ou carregamento -->
  <div class="error-state" *ngIf="!workoutStarted && exercises.length === 0">
    <ion-icon name="alert-circle-outline" class="error-icon"></ion-icon>
    <h2>Nenhum exerc√≠cio encontrado</h2>
    <p>Verifique se os dados do treino foram carregados corretamente.</p>
    <ion-button (click)="router.navigate(['/tabs/home'])" fill="outline">
      Voltar ao In√≠cio
    </ion-button>
  </div>

</ion-content>
